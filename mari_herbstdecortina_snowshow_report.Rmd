---
title: "assignment 4"
author: "Mari Herbst"
date: "11/3/2021"
output: 
  html_document: 
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(kableExtra)
library(ggbeeswarm)
```

# Introduction

INTRO HERE

# Data and analysis

data citation: Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14

Read in the data using here() to create a system agnostic file path.

```{r}
bonanza_hares <- read_csv(here("data", "bonanza_hares.csv"))
```

# Juvenile hare investigations

## Annual juvenile hare trap counts

- Transform the data to separate year into its own column

```{r}
hares_year <- bonanza_hares %>%
  mutate(date = mdy(date)) %>% # change class to date
  mutate(year = year(date))
```

- Summarize the data to get a count of trapped juvenile hares per year

```{r}
hares_summary <- hares_year %>%
  filter(age == "j") %>% # select only juvenile hare observations
  group_by(year) %>% 
  summarize(hare_count = n()) # summarize hares_year by year and count of hares trapped
```

- Create a plot of trapped hare counts per year

```{r}
ggplot(data = hares_summary, aes(x = year, y = hare_count)) + # create a plot of hare trapped counts per year
  geom_col(fill = "darkolivegreen") + # in a bar graph where the bars are colored olive green
  scale_x_continuous(breaks = 1998:2012) + # 
  theme(axis.text.x = element_text(angle = 90)) + # rotate x-axis labels for easier reading
  labs(x = "Year", # label axes
       y = "Count",
       title = "Count of hares trapped per year") # add graph title
  
```

Figure 1. Count of hares trapped per year: Snowshoe hares were trapped and released over the course of 1998-2012 at three locations in the Tanana Valley in Alaska.

### Major takeaways

The most juvenile hares recorded in a single year was `r max(hares_summary$hare_count)`. No juvenile hares were trapped in . The mean number of juvenile snowshoe hare observations from 1998-2012 is `r sum(hares_summary$hare_count)/12` and the median value is `r median(hares_summary$hare_count)`. The trends in hare counts displayed on this graph show a decline in juvenile hare counts over time with occasional peaks. To standardize juvenile hare populations for future analyses, I would recommend creating a more regular interval for hare data collection. The dates of hare collections are varied over the course of the years where data is presented. They frequently represent different times of year where hare populations may differ for various reasons that are not isolated by the nature of the study set up at present.

## Visualize juvenile hare weights

- Change labels to make data easier to understand once visualized

```{r}
bonanza_clean <- bonanza_hares %>%
  filter(age == "j") %>% # filter for juvenile hares
  mutate(sex = case_when( # when sex =
         sex == "m" ~ "male", # "m" change to "male"
         sex == "f" ~ "female")) %>%
  mutate(grid = case_when( # when grid =
         grid == "bonbs" ~ "Bonanza Black Spruce", # "bonbs" change to "Bonanza Black Spruce"
         grid == "bonrip" ~ "Bonanza Riparian",
         grid == "bonmat" ~ "Bonanza Mature"))
```

- Create a plot of juvenile hare weights by sex and collection site (grid)

```{r}
ggplot(data = bonanza_clean, aes(x = sex, y = weight)) + # only need 1 variable for a histogram, the other is count
  geom_beeswarm(na.rm = FALSE, aes(color = sex)) + # include NA values, assign color depending on sex
  facet_wrap(~ grid) + # divide data by collection site
  geom_boxplot(fill = NA, outlier.colour = NA) + # add a boxplot to visualize summary statistics
  theme(axis.text.x = element_text(angle = 90)) + # rotate x axis values for easier reading
  labs(x = "sex", y = "weight (g)", title = "Juvenile Hare Weight Distribution by Grid Site") + # label axes and title
  theme_minimal()
```

caption/conclusion???

## Juvenile weight comparison by sex

- Create a table of summary statistics for hare weights

```{r}
weight_summary_stats <- bonanza_clean %>%
  group_by(sex) %>%
  summarize(mean_weight = round(mean(weight, na.rm = TRUE), 2), # 'na.rm = TRUE' to remove NA values, round() to choose number of digits
            median_weight = median(weight, na.rm = TRUE), 
            sd_weight = round(sd(weight, na.rm = TRUE), 2))

#finalize table
weight_summary_stats %>%
  kable(col.names = c("sex", "mean weight (g)", "median weight (g)", "standard deviation (g)" ), # finalized column names
        caption = "Table 1. Summary statistics for juvenile snowshoe hares trapped and recorded between 1998-2012 in Alaska. NA indicates no sex was recorded.") %>%
  kable_paper() #styling
```

```{r, include = FALSE}
# exploratory visualizations

#histogram to check for normal distribution
ggplot(data = bonanza_clean, aes(x = weight)) +
  geom_histogram(aes(fill = sex)) +
  facet_wrap(~ sex)

## q-q plot to check for normal distribution
ggplot(data = bonanza_clean, aes(sample = weight)) +
  stat_qq() +
  facet_wrap(~ sex) +
  theme_minimal()
```

### T-test and major takeaways

```{r}
female_hares <- bonanza_clean %>%
  filter(sex == "female") %>%
  pull(weight)

male_hares <- bonanza_clean %>%
  filter(sex == "male") %>%
  pull(weight)

hare_ttest <- t.test(female_hares, male_hares)
```

On average, male snowshoe hares weigh more than female snowshoe hares, `r round(mean(male_hares), 2)` $\pm$ `r round(sd(male_hares),2)` and `r round(mean(female_hares),2)` $\pm$ `r round(sd(female_hares),2)`, respectively (mean $\pm$ one standard deviation). The absolute difference in means is `r round(mean(male_hares), 2) - round(mean(female_hares),2)` which amounts to a `r ((mean(male_hares)-mean(female_hares))/(mean(male_hares) + mean(female_hares))/2) * 100`

ADD WARNINGS, MESSAGES = FALSE WHEN DONE!!